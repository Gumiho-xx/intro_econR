<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>非线性回归</title>
    <meta charset="utf-8" />
    <meta name="author" content="冯凌秉" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# 非线性回归
### 冯凌秉
### <span style="font-size: 70%;"> 江西财经大学 <br> 产业经济研究院</span>
### 2020<br><br> <i class="fas  fa-paper-plane "></i> <a href="mailto:feng.lingbing@jxufe.edu.cn" class="email">feng.lingbing@jxufe.edu.cn</a>

---



# 多项式回归：二次项
在CASchools数据的例子中，我们研究学区居民的收入和学生测试成绩的关系。
由相关系数可知，该对变量的线性相关关系是显著的。


```r
library(AER)                                                     
data(CASchools)
CASchools$size &lt;- CASchools$students/CASchools$teachers
CASchools$score &lt;- (CASchools$read + CASchools$math) / 2   
cor(CASchools$income, CASchools$score)
&gt; [1] 0.7124308
```

下图中我们给出简单回归直线和二次回归的拟合直线：

`$$TestScore_i = \beta_0 + \beta_1 \times income_i + \beta_2 \times income_i^2 + u_i,$$`
---
# 二次项回归
.pull-left[

```r
linear_model&lt;- lm(score ~ income, data = CASchools)
plot(CASchools$income, CASchools$score,
     col = "steelblue",
     pch = 20,
     xlab = "District Income (thousands of dollars)", 
     ylab = "Test Score",
     cex.main = 0.9,
     main = "Test Score vs. District Income and a Linear OLS Regression Function")
abline(linear_model, 
       col = "red", 
       lwd = 2)
quadratic_model &lt;- lm(score ~ income + I(income^2), data = CASchools)
plot(CASchools$income, CASchools$score,
     col  = "steelblue",
     pch = 20,
     xlab = "District Income (thousands of dollars)",
     ylab = "Test Score",
     main = "Estimated Linear and Quadratic Regression Functions")
abline(linear_model, col = "black", lwd = 2)
order_id &lt;- order(CASchools$income)
lines(x = CASchools$income[order_id], 
      y = fitted(quadratic_model)[order_id],
      col = "red", 
      lwd = 2) 
```
]

.pull-right[
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-2-1.png" width="504" /&gt;&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-2-2.png" width="504" /&gt;
]

---
# 二次项系数估计

```r
coeftest(quadratic_model, vcov. = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;                Estimate  Std. Error  t value  Pr(&gt;|t|)    
&gt; (Intercept) 607.3017435   2.9017544 209.2878 &lt; 2.2e-16 ***
&gt; income        3.8509939   0.2680942  14.3643 &lt; 2.2e-16 ***
&gt; I(income^2)  -0.0423084   0.0047803  -8.8505 &lt; 2.2e-16 ***
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

`$$\widehat{TestScore}_i = \underset{(2.90)}{607.3} + \underset{(0.27)}{3.85} \times income_i - \underset{(0.0048)}{0.0423} \times income_i^2.$$`
二次项系数估计为-0.0423，并且在1%的显著性水平下是显著的。

因此用一个**倒U形**来拟合二者的关系更加合适。

---
# 多项式回归

在二次项回归的基础上，我们可以增加X变量的幂级，建立r阶多项式回归
`$$Y_i = \beta_0 + \beta_1 X_i + \beta_2 X_i^2 + \cdots + \beta_r X_i^r + u_i.$$`
可以用如下命令建立三次式回归

```r
cubic_model &lt;- lm(score ~ poly(income, degree = 3, raw = TRUE), data = CASchools)
```

为了检验二次和三次式是否显著，我们可以使用如下联合检验
`$$H_0: \beta_2=0, \ \beta_3=0,\dots,\beta_r=0 \ \ \ \text{vs.} \ \ \ H_1: \text{at least one} \ \beta_j\neq0, \ j=2,\dots,r$$`
R命令如下


```r
R &lt;- rbind(c(0, 0, 1, 0), c(0, 0, 0, 1))
linearHypothesis(cubic_model, white.adj = "hc1",
                 hypothesis.matrix = R)
```


---
# 检验矩阵
.pull-left[

此处的检验矩阵设定是因为
`$$\begin{align*}
  \mathbf{R}{\beta} =&amp; \mathbf{s} \\
  \begin{pmatrix}
    0 &amp; 0 &amp; 1 &amp; 0 \\
    0 &amp; 0 &amp; 0 &amp; 1
  \end{pmatrix}
  \begin{pmatrix}
    \beta_0 \\
    \beta_1 \\
    \beta_2 \\
    \beta_3 \\
  \end{pmatrix} =&amp;
  \begin{pmatrix}
   0 \\
   0
  \end{pmatrix} \\
  \begin{pmatrix}
    \beta_2 \\
    \beta_3
  \end{pmatrix}= &amp;
  \begin{pmatrix}
    0 \\
    0
  \end{pmatrix}.
\end{align*}$$`
]
.pull-right[

```
&gt; Linear hypothesis test
&gt; 
&gt; Hypothesis:
&gt; poly(income, degree = 3, raw = TRUE)2 = 0
&gt; poly(income, degree = 3, raw = TRUE)3 = 0
&gt; 
&gt; Model 1: restricted model
&gt; Model 2: score ~ poly(income, degree = 3, raw = TRUE)
&gt; 
&gt; Note: Coefficient covariance matrix supplied.
&gt; 
&gt;   Res.Df Df      F    Pr(&gt;F)    
&gt; 1    418                        
*&gt; 2    416  2 37.691 9.043e-16 ***
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]

---
# 三次多项式回归模型估计

```r
tab_model(cubic_model)
```

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;score&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;CI&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;p&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;600.08&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;588.62&amp;nbsp;&amp;ndash;&amp;nbsp;611.54&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [1st degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;5.02&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;3.33&amp;nbsp;&amp;ndash;&amp;nbsp;6.71&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;&amp;lt;0.001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [2nd degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.10&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.17&amp;nbsp;&amp;ndash;&amp;nbsp;-0.02&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;strong&gt;0.011&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [3rd degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.00&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.00&amp;nbsp;&amp;ndash;&amp;nbsp;0.00&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.147&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3"&gt;420&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3"&gt;0.558 / 0.555&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

### 三次项系数估计不显著
我们改用稳健估计

---
&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;caption style="font-weight: bold; text-align:left;"&gt;Regression Outputs&lt;/caption&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;score&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;score&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Predictors&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;607.3017 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(2.9018)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;600.0790 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(5.1021)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;3.8510 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.2681)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income^2&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.0423 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.0048)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [1st degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;5.0187 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.7074)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [2nd degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.0958 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.0290)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [3rd degree]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.0007 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(0.0003)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.556 / 0.554&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.558 / 0.555&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="3" style="font-style:italic; border-top:double black; text-align:right;"&gt;* p&amp;lt;0.05&amp;nbsp;&amp;nbsp;&amp;nbsp;** p&amp;lt;0.01&amp;nbsp;&amp;nbsp;&amp;nbsp;*** p&amp;lt;0.001&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;
利用稳健估计后，三次项系数估计变为显著。但是三次项系数估计很小，是否留在模型中？

---
# 多项式回归的系数解释
多项式回归的系数不能按照多元回归的解释套路得到解释。为什么？

因为不能说在给定X和X立方不变的情况下，单位变化的X平方将引起Y多大程度的变化。X平方变化并将导致X和X立方的变化。

可以通过对多项式某一项的变化所导致的Y预测值的变化来测度多项式系数的边际效应：
`$$\Delta \widehat{Y} = \hat{f}(X_1 + \Delta X_1, X_2, \cdots, X_k) - \hat{f}(X_1, X_2, \cdots, X_k).$$`
而且，应该注意到，以下两种单位幅度的变化的边际效应是不同的

1. income从10增加到11

2. income从40增加到41

---
# 多项式回归系数解释

```r
quadriatic_model &lt;- lm(score ~ income + I(income^2), data = CASchools)
new_data &lt;- data.frame(income = c(10, 11))
Y_hat &lt;- predict(quadriatic_model, newdata = new_data)
diff(Y_hat)
&gt;        2 
&gt; 2.962517
new_data &lt;- data.frame(income = c(40, 41))
Y_hat &lt;- predict(quadriatic_model, newdata = new_data)
diff(Y_hat)
&gt;         2 
&gt; 0.4240097
```

[思考]：这种边际效应差异的原因是什么？线性回归中有没有这种差异存在？

---
# 对数变换
变换之后，对回归系数的估计都变得不一样了，我们在解释的时候要十分慎重。
.left-column[
对数变换可以

1. 缩小量纲

2. 改善偏度

我们可以对
1. X对数变换

2. Y对数变换

3. X和Y同时变换
]

.right-column[

```r
LinearLog_model &lt;- lm(score ~ log(income), data = CASchools)
coeftest(LinearLog_model, 
         vcov = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;             Estimate Std. Error t value  Pr(&gt;|t|)    
&gt; (Intercept) 557.8323     3.8399 145.271 &lt; 2.2e-16 ***
&gt; log(income)  36.4197     1.3969  26.071 &lt; 2.2e-16 ***
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
`$$\widehat{TestScore} = 557.8 + 36.42 \times \ln(income).$$`
]

---
# Linear-Log 回归线
.pull-left[
对 `\(\hat{\beta_1}\)` 可以解释为：**income 每增加1%**，score增加 `\(0.01 \times 36.42 = 0.36\)` 分。
[*请证明之*]

```r
plot(score ~ income, 
     col = "steelblue",
     pch = 20,
     data = CASchools,
     main = "Linear-Log Regression Line")
order_id  &lt;- order(CASchools$income)
lines(CASchools$income[order_id],
      fitted(LinearLog_model)[order_id], 
      col = "red", 
      lwd = 2)
new_data &lt;- data.frame(income = c(10, 11, 40, 41))
Y_hat &lt;- predict(LinearLog_model, newdata = new_data)
Y_hat_matrix &lt;- matrix(Y_hat, nrow = 2, byrow = TRUE)
Y_hat_matrix[, 2] - Y_hat_matrix[, 1]
&gt; [1] 3.471166 0.899297
```
]

.pull-right[
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-11-1.png" width="504" /&gt;

```
&gt; [1] 3.471166 0.899297
```
]

---
# Y对数变换
模型为
`$$\ln(Y_i) = \beta_0 + \beta_1 \times X_i + u_i , \ \ i=1,...,n.$$`

```r
LogLinear_model &lt;- lm(log(score) ~ income, data = CASchools)
coeftest(LogLinear_model, 
         vcov = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;               Estimate Std. Error  t value  Pr(&gt;|t|)    
&gt; (Intercept) 6.43936234 0.00289382 2225.210 &lt; 2.2e-16 ***
&gt; income      0.00284407 0.00017509   16.244 &lt; 2.2e-16 ***
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
估计模型为：
`$$\widehat{\ln(TestScore)} = 6.439 + 0.00284 \times income.$$`

解释为：income每增加一个单位 (1000美金)，score增加 `\(100 \times 0.00284 \% = 0.284\%\)`。

---
# X和Y同时对数变换
模型为:
`$$\ln(Y_i) = \beta_0 + \beta_1 \times \ln(X_i) + u_i, \ \ i=1,...,n.$$`

```r
LogLog_model &lt;- lm(log(score) ~ log(income), data = CASchools)
coeftest(LogLog_model, 
         vcov = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;              Estimate Std. Error  t value  Pr(&gt;|t|)    
&gt; (Intercept) 6.3363494  0.0059246 1069.501 &lt; 2.2e-16 ***
&gt; log(income) 0.0554190  0.0021446   25.841 &lt; 2.2e-16 ***
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
估计模型为
`$$\widehat{\ln(TestScore)} = 6.336 + 0.0554 \times \ln(income).$$`
解释为：income每增加1%，score增加 `\(\hat\beta_1 \%\)`。

---
# 对数变换效果
.pull-left[
注意图中的Y变量已经事先做了对数变换


```r
plot(log(score) ~ income, 
     col = "steelblue", 
     pch = 20, 
     data = CASchools,
     main = "Log-Linear Regression Function")
order_id  &lt;- order(CASchools$income)
lines(CASchools$income[order_id], 
      fitted(LogLinear_model)[order_id], 
      col = "red", 
      lwd = 2)
lines(sort(CASchools$income), 
      fitted(LogLog_model)[order(CASchools$income)], 
      col = "green", 
      lwd = 2)
legend("bottomright",
       legend = c("log-linear model", "log-log model"),
       lwd = 2,
       col = c("red", "green"))    
```
]

.pull-right[
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-14-1.png" width="504" /&gt;
]

---
# 多项式模型还是对数模型
.pull-left[

```r
polyLog_model &lt;- lm(score ~ log(income) + I(log(income)^2) + I(log(income)^3), data = CASchools)
adj_R2 &lt;-rbind("quadratic" = summary(quadratic_model)$adj.r.squared,
               "cubic" = summary(cubic_model)$adj.r.squared,
               "LinearLog" = summary(LinearLog_model)$adj.r.squared,
               "LogLinear" = summary(LogLinear_model)$adj.r.squared,
               "LogLog" = summary(LogLog_model)$adj.r.squared,
               "polyLog" = summary(polyLog_model)$adj.r.squared)

# assign column names
colnames(adj_R2) &lt;- "adj_R2"
adj_R2
&gt;              adj_R2
&gt; quadratic 0.5540444
&gt; cubic     0.5552279
&gt; LinearLog 0.5614605
&gt; LogLinear 0.4970106
&gt; LogLog    0.5567251
&gt; polyLog   0.5599944
```
]
.pull-right[
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-16-1.png" width="504" /&gt;
]

---
# 交叉项与交互效应
如果某个独立变量X1对Y的影响取决于另外一个独立变量X2的取值，我们说X1和X2存在交互效应。

之前的例子中，我们可能认为班级规模对学生得分的影响，可能在英语学习者比例高的社区更加显著。这里就需要使用班级规模STR和英语学习者比例english两个变量的交互项来考察它们的交互效应。

交互效应可能有三种形式

1. 两个二元变量交互

2. 一个二元变量和一个连续变量交互

3. 两个连续变量交互

考察如下模型考察大学学历和性别对个人收入的影响：
`$$Y_i = \beta_0 + \beta_1 \times D_{1i} + \beta_2 \times D_{2i} + u_i$$`
---
# 交互效应实例

假设 Y代表个人收入的对数值，D1表示该人是否具有大学学历，D2表示该人的性别。

加入交叉项考察交互效应
`$$Y_i = \beta_0 + \beta_1 \times D_{1i} + \beta_2 \times D_{2i} + \beta_3 \times (D_{1i} \times D_{2i}) + u_i$$`
`\((D_{1i} \times D_{2i})\)` 称为交叉项，$\beta_3$ 衡量的即时交互效应的程度。也就是学历对收入的影响和性别有关。


`$$\begin{align*}
  E(Y_i\vert D_{1i}=0, D_{2i} = d_2) =&amp; \, \beta_0 + \beta_1 \times 0 + \beta_2 \times d_2 + \beta_3 \times (0 \times d_2) \\
  =&amp; \, \beta_0 + \beta_2 \times d_2.
\end{align*}$$`
`$$\begin{align*}
  E(Y_i\vert D_{1i}=1, D_{2i} = d_2) =&amp; \, \beta_0 + \beta_1 \times 1 + \beta_2 \times d_2 + \beta_3 \times (1 \times d_2) \\
  =&amp; \, \beta_0 + \beta_1 + \beta_2 \times d_2 + \beta_3 \times d_2.
\end{align*}$$`
`$$E(Y_i\vert D_{1i}=1, D_{2i} = d_2) - E(Y_i\vert D_{1i}=0, D_{2i} = d_2) = \beta_1 + \beta_3 \times d_2$$`
`\(\beta_3\)` 在此处表示学历对收入的影响的男女差距。

---
# 交互效应实例

创建两个新的二值变量

```r
CASchools$HiSTR &lt;- as.numeric(CASchools$size &gt;= 20)
CASchools$HiEL &lt;- as.numeric(CASchools$english &gt;= 10)
```

建立模型

```r
bi_model &lt;- lm(score ~ HiSTR * HiEL, data = CASchools)
coeftest(bi_model, vcov. = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;             Estimate Std. Error  t value  Pr(&gt;|t|)    
&gt; (Intercept) 664.1433     1.3881 478.4589 &lt; 2.2e-16 ***
&gt; HiSTR        -1.9078     1.9322  -0.9874    0.3240    
&gt; HiEL        -18.3155     2.3340  -7.8472 3.634e-14 ***
&gt; HiSTR:HiEL   -3.2601     3.1189  -1.0453    0.2965    
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

估计模型为
`$$\widehat{TestScore} = \underset{(1.39)}{664.1} - \underset{(1.93)}{1.9} \times HiSTR - \underset{(2.33)}{18.3} \times HiEL - \underset{(3.12)}{3.3} \times (HiSTR \times HiEL)$$`
参数解释为：
`$$\begin{align*}
\widehat{TestScore} = \hat\beta_0 = 664.1 \quad &amp;\Leftrightarrow \quad HiSTR = 0, \, HIEL = 0\\
\widehat{TestScore} = \hat\beta_0 + \hat\beta_2 = 664.1 - 18.3 = 645.8 \quad &amp;\Leftrightarrow \quad HiSTR = 0, \, HIEL = 1\\
\widehat{TestScore} = \hat\beta_0 + \hat\beta_1 = 664.1 - 1.9 = 662.2 \quad &amp;\Leftrightarrow \quad HiSTR = 1, \, HIEL = 0\\
\widehat{TestScore} = \hat\beta_0 + \hat\beta_1 + \hat\beta_2 + \hat\beta_3  = 664.1 - 1.9 - 18.3 - 3.3 = 640.6 \quad &amp;\Leftrightarrow \quad HiSTR = 1, \, HIEL = 1
\end{align*}$$`
验证之：

```r
predict(bi_model, newdata = data.frame("HiSTR" = 0, "HiEL" = 0))
&gt;        1 
&gt; 664.1433
predict(bi_model, newdata = data.frame("HiSTR" = 0, "HiEL" = 1))
&gt;        1 
&gt; 645.8278
predict(bi_model, newdata = data.frame("HiSTR" = 1, "HiEL" = 0))
&gt;        1 
&gt; 662.2354
predict(bi_model, newdata = data.frame("HiSTR" = 1, "HiEL" = 1))
&gt;        1 
&gt; 640.6598
```

---
# 连续与二元变量交互
X为某人的工作经历年限，是一个连续变量。

D表示该人是否具有大学学历，是一个二元变量。

可以建立如下三种模型：

1. 同斜率，不同截距
`$$Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_i + u_i$$`

2. 截距不同，斜率不同
`$$Y_i = \beta_0 + \beta_1 X_i + \beta_2 (X_i \times D_i) + u_i.$$`

3. 不同斜率，相同截距
`$$Y_i = \beta_0 + \beta_1 X_i + \beta_2 D_i + \beta_3 \times (X_i \times D_i) + u_i$$`
---
# 三种模型图示
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-20-1.png" width="720" style="display: block; margin: auto;" /&gt;

---
# 实例
建立如下模型：
`$$\widehat{TestScore_i} = \beta_0 + \beta_1 \times size_i + \beta_2 \times HiEL_i + \beta_2 (size_i \times HiEL_i) + u_i.$$`

```r
bci_model &lt;- lm(score ~ size + HiEL + size * HiEL, data = CASchools)
coeftest(bci_model, vcov. = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;              Estimate Std. Error t value Pr(&gt;|t|)    
&gt; (Intercept) 682.24584   11.86781 57.4871   &lt;2e-16 ***
&gt; size         -0.96846    0.58910 -1.6440   0.1009    
&gt; HiEL          5.63914   19.51456  0.2890   0.7727    
&gt; size:HiEL    -1.27661    0.96692 -1.3203   0.1875    
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
`$$\widehat{TestScore} = \underset{(11.87)}{682.2} - \underset{(0.59)}{0.97} \times size + \underset{(19.51)}{5.6} \times HiEL - \underset{(0.97)}{1.28} \times (size \times HiEL).$$`
---
# 模型解释
这是一个变截距变斜率模型，对于一个来自于低英语学习比例社区的人 `\(HiEL_i=0\)`：
`$$\widehat{TestScore} = 682.2 - 0.97\times size_i.$$`
对于 `\(HiEL_i\ne0\)`：
`$$\begin{align*} 
  \widehat{TestScore} =&amp; \, 682.2 + 5.6 - 0.97\times size_i - 1.28 \times size_i \\
   =&amp; \, 687.8 - 2.25 \times size_i.
\end{align*}$$`

两类人群与size的线性关系，具有不同的截距和斜率。

---

.pull-left[

```r
id &lt;- CASchools$english &gt;= 10
plot(CASchools$size[!id], CASchools$score[!id],
     xlim = c(0, 27),
     ylim = c(600, 720),
     pch = 20,
     col = "red",
     main = "",
     xlab = "Class Size",
     ylab = "Test Score")
points(CASchools$size[id], CASchools$score[id],
     pch = 20,
     col = "green")
coefs &lt;- bci_model$coefficients
abline(coef = c(coefs[1], coefs[2]),
       col = "red",
       lwd = 1.5)
abline(coef = c(coefs[1] + coefs[3], coefs[2] + coefs[4]),
       col = "green", 
       lwd = 1.5 )
legend("topright", 
       pch = c(20, 20), 
       col = c("red", "green"), 
       legend = c("HiEL = 0", "HiEL = 1"))    
```
]

.pull-right[
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-22-1.png" width="504" /&gt;
]
两类人群与size的线性关系，具有不同的截距和斜率。

---
# 连续变量交互
X1是工作年限，X2是受教育年限，二者都是连续变量，建立如下模型：
`$$Y_i = \beta_0 + \beta_1 \times X_{1i} + \beta_2 \times X_{2i} + \beta_3 \times (X_{1i} \times X_{2i}) + u_i$$`
给定 `\(X_2\)` 的水平, `\(X_1\)` 的变化对 `\(Y\)` 的影响为
`$$\frac{\Delta Y}{\Delta X_1} = \beta_1 + \beta_3 X_2.$$`

同理:
`$$\frac{\Delta Y}{\Delta X_2} = \beta_2 + \beta_3 X_1$$`
均体现了二者对Y的交互影响。
`$$\begin{align}
\Delta Y_i = (\beta_1 + \beta_3 X_2) \Delta X_1 + (\beta_2 + \beta_3 X_1) \Delta X_2 + \beta_3\Delta X_1 \Delta X_2. \tag{8.2}
\end{align}$$`

---
# 数据实例

```r
cci_model &lt;- lm(score ~ size + english + english * size, data = CASchools) 
coeftest(cci_model, vcov. = vcovHC, type = "HC1")
&gt; 
&gt; t test of coefficients:
&gt; 
&gt;                 Estimate  Std. Error t value Pr(&gt;|t|)    
&gt; (Intercept)  686.3385268  11.7593466 58.3654  &lt; 2e-16 ***
&gt; size          -1.1170184   0.5875136 -1.9013  0.05796 .  
&gt; english       -0.6729119   0.3741231 -1.7986  0.07280 .  
&gt; size:english   0.0011618   0.0185357  0.0627  0.95005    
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

模型估计为:
`$$\widehat{TestScore} = \underset{(11.76)}{686.3} - \underset{(0.59)}{1.12} \times STR - \underset{(0.37)}{0.67} \times PctEL + \underset{(0.02)}{0.0012} \times (STR\times PctEL).$$`
**[练习]**尝试解释 `\(\beta_3\)`，虽然其估计值不显著。

---
# 实例

```r
data("Journals")
Journals$PricePerCitation &lt;- Journals$price/Journals$citations
Journals$Age &lt;- 2000 - Journals$foundingyear
Journals$Characters &lt;- Journals$charpp * Journals$pages/10^6
Journals$Subscriptions &lt;- Journals$subs
```
尝试建立如下四个模型:
`$$\begin{align*}
  (I)\quad \ln(Subscriptions_i) =&amp; \, \beta_0 + \beta_1 \ln(PricePerCitation_i) + u_i \\
  \\
  (II)\quad \ln(Subscriptions_i) =&amp; \, \beta_0 + \beta_1 \ln(PricePerCitation_i) + \beta_4 \ln(Age_i) + \beta_6 \ln(Characters_i) + u_i \\
  \\
  (III)\quad \ln(Subscriptions_i) =&amp; \, \beta_0 + \beta_1 \ln(PricePerCitation_i) + \beta_2 \ln(PricePerCitation_i)^2 \\
  +&amp; \, \beta_3 \ln(PricePerCitation_i)^3 + \beta_4 \ln(Age_i) + \beta_5 \left[\ln(Age_i) \times \ln(PricePerCitation_i)\right] \\ +&amp; \, \beta_6 \ln(Characters_i) + u_i \\
  \\
  (IV)\quad \ln(Subscriptions_i) =&amp; \, \beta_0 + \beta_1 \ln(PricePerCitation_i) + \beta_4 \ln(Age_i) + \beta_6 \ln(Characters_i) + u_i
\end{align*}$$`

---

```r
m1 &lt;- lm(log(Subscriptions) ~ log(PricePerCitation), 
                    data = Journals)
m2 &lt;- lm(log(Subscriptions) ~ log(PricePerCitation) 
                    + log(Age) + log(Characters), 
                    data = Journals)
m3 &lt;- lm(log(Subscriptions) ~ 
                    log(PricePerCitation) + I(log(PricePerCitation)^2) 
                    + I(log(PricePerCitation)^3) + log(Age) 
                    + log(Age):log(PricePerCitation) + log(Characters), 
                    data = Journals)
m4 &lt;- lm(log(Subscriptions) ~ 
                    log(PricePerCitation) + log(Age) 
                    + log(Age):log(PricePerCitation) + 
                    log(Characters), 
                    data = Journals)
```

$$
`\begin{align*}
  (I)\quad \widehat{\ln(Subscriptions_i)} =&amp; \, 4.77 - 0.53 \ln(PricePerCitation_i) \\
  (II)\quad \widehat{\ln(Subscriptions_i)} =&amp; \, 3.21 - 0.41 \ln(PricePerCitation_i) + 0.42 \ln(Age_i) + 0.21 \ln(Characters_i) \\
  (III)\quad \widehat{\ln(Subscriptions_i)} =&amp; \, 3.41 - 0.96 \ln(PricePerCitation_i) + 0.02 \ln(PricePerCitation_i)^2 \\
  &amp;+ 0.004 \ln(PricePerCitation_i)^3 + 0.37 \ln(Age_i) \\
  &amp;+ 0.16 \left[\ln(Age_i) \times \ln(PricePerCitation_i)\right] \\ &amp;+ 0.23 \ln(Characters_i) \\
  (IV)\quad \widehat{\ln(Subscriptions_i)} =&amp; \, 3.43 - 0.90 \ln(PricePerCitation_i) + 0.37 \ln(Age_i) \\ 
  &amp;+ 0.14 \left[\ln(Age_i) \times \ln(PricePerCitation_i)\right] + 0.23 \ln(Characters_i)
\end{align*}`
$$
---
&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;caption style="font-weight: bold; text-align:left;"&gt;Regression Outputs&lt;/caption&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black; font-weight: bold; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black;"&gt;log(Subscriptions)&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black;"&gt;log(Subscriptions)&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black;"&gt;log(Subscriptions)&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:italic; font-weight:normal; padding:0.2cm; border-bottom:1px solid black;"&gt;log(Subscriptions)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" color: red; border-bottom:1px solid black; font-weight: bold; "&gt;Predictors&lt;/td&gt;
&lt;td style=" color: red; border-bottom:1px solid black; "&gt;Estimates&lt;/td&gt;
&lt;td style=" color: red; border-bottom:1px solid black; "&gt;Estimates&lt;/td&gt;
&lt;td style=" color: red; border-bottom:1px solid black; "&gt;Estimates&lt;/td&gt;
&lt;td style=" color: red; border-bottom:1px solid black; "&gt;Estimates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;4.77 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.06)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;3.21 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.31)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;3.41 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.32)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;3.43 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.31)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;PricePerCitation [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;-0.53 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.04)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;-0.41 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.04)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;-0.96 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.19)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;-0.90 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.16)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;Age [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.42 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.09)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.37 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.09)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.37 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.09)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;Characters [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.21 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.11)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.23 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(0.11)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.23 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(0.11)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;I(PricePerCitation)^2&lt;br&gt;[I(log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.02 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.02)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;I(PricePerCitation)^3&lt;br&gt;[I(log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.00 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.01)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; font-weight: bold; "&gt;PricePerCitation [log] *&lt;br&gt;Age [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.16 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.06)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align: left;  "&gt;0.14 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.04)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; color: blue; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center; border-top:1px solid;" colspan="1"&gt;180&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center; border-top:1px solid;" colspan="1"&gt;180&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center; border-top:1px solid;" colspan="1"&gt;180&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center; border-top:1px solid;" colspan="1"&gt;180&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; color: blue;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center;" colspan="1"&gt;0.557 / 0.555&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center;" colspan="1"&gt;0.613 / 0.607&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center;" colspan="1"&gt;0.635 / 0.622&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; color: blue; text-align:center;" colspan="1"&gt;0.634 / 0.626&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="5" style="font-style:italic; border-top:double black; text-align:right;"&gt;* p&amp;lt;0.05&amp;nbsp;&amp;nbsp;&amp;nbsp;** p&amp;lt;0.01&amp;nbsp;&amp;nbsp;&amp;nbsp;*** p&amp;lt;0.001&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

---
# 图示

.pull-left[

结合回归输出表和右图，我们可以得出什么结论

1. 对于journal的需求，年轻journal的弹性要高于年限长的journal

2. 图b的线性关系是显著的，二次项和三次项回归系数均不显著，因此非线性模型没有必要。

3. 需求弹性与期刊文章的字数多少有关，在price和age不变的条件下，字数越多，需求弹性越大。

总体来说，需求的弹性是很弱的，也就是说，图书馆对于期刊的需求量对于价格是相当不敏感的。

对于age = 5的年轻期刊，需求的价格弹性可以估计为 `\(-0.899+0.374\times\ln(5)+0.141\times\left[\ln(1)\times\ln(5)\right] \approx -0.3\)`, 即价格增加1%，需求量只会下降0.3%。

这个结论与实际相符吗？

]

.pull-right[

&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-27-1.png" width="504" /&gt;
]

---
# 三个问题
整体上，我们的关键命题是：班级规模和学生测试成绩成反比，班级规模小的学生更可能获得高成绩。那么我们我们尝试回答以下三个问题：

1. 在控制不同地区的其他经济变量下，这样的关系是否与地区的英语学习者比例有关？

2. 主关系中是否存在非线性关系？

3. 班级规模（师生比）降低2个单位，学生的成绩会提升多少分？

我们该怎么做？

接下来，我们考虑7个模型

---
`$$\begin{align}
 TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_4 english_i + \beta_9 lunch_i + u_i \\
 TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_4 english_i + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_5 HiEL_i + \beta_6 (HiEL_i\times size_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_5 HiEL_i + \beta_6 (HiEL_i\times size_i) + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_5 HiEL_i + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_3 size_i^3 + \beta_5 HiEL_i + \beta_6 (HiEL\times size) \\  &amp;+ \beta_7 (HiEL_i\times size_i^2) + \beta_8 (HiEL_i\times size_i^3) + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i \\
  TestScore_i =&amp; \beta_0 + \beta_1 size_i + \beta_2 size_i^2 + \beta_3 size_i^3 + \beta_4 english + \beta_9 lunch_i + \beta_{10} \ln(income_i) + u_i
\end{align}$$`


```r
m1 &lt;- lm(score ~ size + english + lunch, data = CASchools)
m2 &lt;- lm(score ~ size + english + lunch + log(income), data = CASchools)
m3 &lt;- lm(score ~ size + HiEL + HiEL:size, data = CASchools)
m4 &lt;- lm(score ~ size + HiEL + HiEL:size + lunch + log(income), 
    data = CASchools)
m5 &lt;- lm(score ~ size + I(size^2) + I(size^3) + HiEL + lunch + log(income), 
    data = CASchools)
m6 &lt;- lm(score ~ size + I(size^2) + I(size^3) + HiEL + HiEL:size + 
    HiEL:I(size^2) + HiEL:I(size^3) + lunch + log(income), data = CASchools)
m7 &lt;- lm(score ~ size + I(size^2) + I(size^3) + english + lunch + 
    log(income), data = CASchools)
```

---

&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;tr&gt;
&lt;th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; "&gt;&amp;nbsp;&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M1&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M2&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M3&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M4&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M5&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M6&lt;/th&gt;
&lt;th colspan="1" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; "&gt;M7&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; "&gt;Coeffcient&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  "&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7"&gt;Estimates&lt;/td&gt;
&lt;td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col8"&gt;Estimates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;(Intercept)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;700.15 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(5.64)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;658.55 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(8.75)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;682.25 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(12.07)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;653.67 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(10.05)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;252.05 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(179.72)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;122.35 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(205.05)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;244.81 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(181.90)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-1.00 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.27)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.73 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.26)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.97 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.60)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.53 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.35)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;64.34 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(27.29)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;83.70 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(31.51)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;65.29 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(27.71)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;english&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.12 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.18 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;-0.17 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;lunch&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.55 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.02)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.40 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.41 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.42 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;-0.42 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;-0.40 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;income [log]&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;11.57 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.84)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;12.12 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.82)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;11.75 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.80)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;11.80 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.81)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;11.51 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.83)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;HiEL&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;5.64 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(19.89)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;5.50 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(10.01)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-5.47 &lt;sup&gt;***&lt;/sup&gt;&lt;br&gt;(1.05)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;816.08 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(354.10)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size * HiEL&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-1.28 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.99)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-0.58 &lt;sup&gt;&lt;/sup&gt;&lt;br&gt;(0.51)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;-123.28 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(54.29)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size^2&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;-3.42 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(1.37)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;-4.38 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(1.60)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;-3.47 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(1.39)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size^3&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;0.06 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.02)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;0.07 &lt;sup&gt;**&lt;/sup&gt;&lt;br&gt;(0.03)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;0.06 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(0.02)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size^2 * HiEL&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;6.12 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(2.75)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; "&gt;size^3 * HiEL&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "&gt;&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"&gt;-0.10 &lt;sup&gt;*&lt;/sup&gt;&lt;br&gt;(0.05)&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col8"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;"&gt;Observations&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="1"&gt;420&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;"&gt;R&lt;sup&gt;2&lt;/sup&gt; / R&lt;sup&gt;2&lt;/sup&gt; adjusted&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.775 / 0.773&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.796 / 0.794&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.310 / 0.305&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.797 / 0.795&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.801 / 0.798&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.803 / 0.799&lt;/td&gt;
&lt;td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="1"&gt;0.801 / 0.798&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="8" style="font-style:italic; border-top:double black; text-align:right;"&gt;* p&amp;lt;0.05&amp;nbsp;&amp;nbsp;&amp;nbsp;** p&amp;lt;0.01&amp;nbsp;&amp;nbsp;&amp;nbsp;*** p&amp;lt;0.001&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

---
# 非线性陷阱
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-30-1.png" width="720" style="display: block; margin: auto;" /&gt;

可以看到，size对score的非线性影响虽然显著，但其实是比较弱的。

---
# 非线性陷阱
&lt;img src="lec5_nonlinear_reg_files/figure-html/unnamed-chunk-31-1.png" width="720" style="display: block; margin: auto;" /&gt;

---
# 结论

- 虽然 `\(HiEL:size, HiEL:size^2, HiEL:size^3\)` 三个交叉项的系数估计是显著的，但是在size位于17-23之间时，score和size的关系基本是线性的，并且与HiEL的取值关系不大。

- 17-23的区间的样本量比例为90%左右，在该区间左边和右边的观测值个数较少。而非线性主要体现在左右两个极值区间。

- 因此，虽然是显著的，但是这样的非线性和非线性交叉效应也是可疑的。
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  /* Replace <script> tags in slides area to make them executable
   *
   * Runs after post-processing of markdown source into slides and replaces only
   * <script>s on the last slide of continued slides using the .has-continuation
   * class added by xaringan. Finally, any <script>s in the slides area that
   * aren't executed are commented out.
   */
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container:not(.has-continuation) script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
  var scriptsNotExecuted = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container.has-continuation script'
  );
  if (!scriptsNotExecuted.length) return;
  for (var i = 0; i < scriptsNotExecuted.length; i++) {
    var comment = document.createComment(scriptsNotExecuted[i].outerHTML)
    scriptsNotExecuted[i].parentElement.replaceChild(comment, scriptsNotExecuted[i])
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url(jxufe_logo.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 50px;
  height: 60px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
